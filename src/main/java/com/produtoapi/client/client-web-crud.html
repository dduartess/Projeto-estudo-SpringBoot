<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Client web Externo</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				margin: 20px;
				max-width: 800px;
			}
			div {
				margin: 10px 0;
			}
			label {
				display: inline-block;
				width: 100px;
			}
			input {
				padding: 5px;
				width: 200px;
			}
			button {
				margin: 5px;
				padding: 10px 15px;
				border: none;
				cursor: pointer;
				border-radius: 4px;
			}
			#produtosTable {
				border-collapse: collapse;
				width: 100%;
				margin: 20px 0;
			}
			#produtosTable th,
			#produtosTable td {
				padding: 10px;
				text-align: left;
				border: 1px solid #ddd;
			}
			#produtosTable th {
				background-color: #f2f2f2;
			}
			#produtosTable tr:hover {
				background-color: #f5f5f5;
			}
		</style>
	</head>
	<body>
		<h1>CRUD - Client</h1>
		<div>
			<label for="id">ID:</label>
			<input type="text" id="id">
		</div>
		<div>
			<label for="nome">Nome:</label>
			<input type="text" id="nome">
		</div>
		<div>
			<label for="preco">Preço:</label>
			<input type="text" id="preco">
		</div>
		<div>
			<label for="quantidade">Quantidade:</label>
			<input type="text" id="quantidade">
		</div>
		<div>
			<label for="status">Status:</label>
			<input type="text" id="status">
		</div>

		<button onclick="salvar()" style="background-color: green; color: white;">Salvar</button>
		<button onclick="atualizar()" style="background-color: blue; color: white;">Atualizar</button>
		<button onclick="deletar()" style="background-color: red; color: white;">Deletar</button>
		<button onclick="carregarCampos()" style="background-color: gray; color: white;">Consultar</button>
		<button onclick="limparCampos()" style="background-color: black; color: white;">Limpar Campos</button>

		<h2>Lista de Produtos</h2>
		<table id="produtosTable" border="1">
			<thead>
				<tr>
					<th>ID</th>
					<th>Nome</th>
					<th>Preço</th>
					<th>Quantidade</th>
					<th>Status</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
		<p id="total-produtos"></p>

		<script>
			const BASE_URL = 'http://localhost:8080/produtos'; //URL DA API

			function getProdutoForm(){
				const nome = document.getElementById('nome').value;
				const preco = document.getElementById('preco').value;
				const quantidade = document.getElementById('quantidade').value;
				const status = document.getElementById('status').value;
				return {nome, preco: parseFloat(preco), quantidade: parseInt(quantidade), status};
			}

			async function listarTodos(){
				const response = await fetch(BASE_URL);
				const produtos = await response.json();
				const tableBody = document.getElementById('produtosTable').getElementsByTagName('tbody')[0];
				const total = document.getElementById('total-produtos');
				tableBody.innerHTML = '';
				produtos.forEach(produto => {
					const row = tableBody.insertRow();
					const cellId = row.insertCell(0);
					const cellNome = row.insertCell(1);
					const cellPreco = row.insertCell(2);
					const cellQuantidade = row.insertCell(3);
					const cellStatus = row.insertCell(4);
					cellId.textContent = produto.id;
					cellNome.textContent = produto.nome;
					cellPreco.textContent = produto.preco;
					cellQuantidade.textContent = produto.quantidade;
					cellStatus.textContent = produto.status;
				});
				total.textContent = `Total de produtos: ${produtos.length}`;
			}

			async function salvar(){
				const produto = getProdutoForm();
				await fetch(BASE_URL, {
					method: 'POST',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify(produto)
				});
				listarTodos();
				limparCampos();
			}

			async function atualizar(){
				const produto = getProdutoForm();
				const id = document.getElementById('id').value;
				await fetch(`${BASE_URL}/${id}`, {
					method: 'PUT',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify(produto)
				});
				listarTodos();
				limparCampos();
			}

			async function deletar(){
				const id = document.getElementById('id').value;
				await fetch(`${BASE_URL}/${id}`, {method: 'DELETE'});
				listarTodos();
				limparCampos();
			}

			function carregarCampos(){
				const id = document.getElementById('id').value;
				fetch(`${BASE_URL}/${id}`)
					.then(response => response.json())
					.then(produto => {
						document.getElementById('nome').value = produto.nome;
						document.getElementById('preco').value = produto.preco;
						document.getElementById('quantidade').value = produto.quantidade;
						document.getElementById('status').value = produto.status;
					})
					.catch(error => {
						console.error('Erro ao consultar produto:', error);
					});
			}

			function limparCampos(){
				document.getElementById('id').value = '';
				document.getElementById('nome').value = '';
				document.getElementById('preco').value = '';
				document.getElementById('quantidade').value = '';
				document.getElementById('status').value = '';
			}

			document.addEventListener('DOMContentLoaded', listarTodos);
		</script>

	</body>
</html>